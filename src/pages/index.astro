---
import Base from "../layouts/Base.astro";
import { getCollection, type CollectionEntry } from "astro:content";

// Load all projects from the content collection
const entries = await getCollection("projects");

// Sort by date desc
entries.sort((a, b) => {
  const da = new Date((a.data.date as any) || 0).getTime();
  const db = new Date((b.data.date as any) || 0).getTime();
  return db - da;
});

// Fallback preview image
const placeholder = `data:image/svg+xml;utf8,${encodeURIComponent(
  `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='675' viewBox='0 0 1200 675'>
    <defs><linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>
      <stop offset='0%' stop-color='#e9eef7'/><stop offset='100%' stop-color='#f6f8fc'/>
    </linearGradient></defs>
    <rect width='100%' height='100%' fill='url(#g)'/>
    <g fill='#8aa0c8' font-family='Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif' font-size='42' font-weight='600' text-anchor='middle' dominant-baseline='middle'>
      <text x='50%' y='50%'>Project Preview</text>
    </g>
  </svg>`
)}`;

// Card builder with types
const toCard = ({ slug, data }: CollectionEntry<"projects">) => {
  const title = data.title ?? "Untitled Project";
  const tags = ((data.tags ?? []) as string[]).slice(0, 4);
  const url = `/projects/${slug}/`;
  return {
    url,
    img: data.hero ?? placeholder,
    title,
    summary: data.summary ?? "",
    tags,
    kicker: tags.length ? tags[0] : "Case Study",
    ariaLabel: "View project — " + title,
    slug,
  };
};

// Selected Graphic Design (tagged "design" or "graphic")
const designCards = entries
  .filter((entry: CollectionEntry<"projects">) => {
    const t = ((entry.data.tags ?? []) as string[]).map((x: string) => x.toLowerCase());
    return t.includes("design") || t.includes("graphic");
  })
  .map(toCard);

// Web-first list excludes those design-only items
const webCards = entries
  .filter((entry: CollectionEntry<"projects">) => {
    const t = ((entry.data.tags ?? []) as string[]).map((x: string) => x.toLowerCase());
    return !(t.includes("design") || t.includes("graphic"));
  })
  .map(toCard);

// Page meta
const page = {
  title: "Shopify Developer — Online Stores & Web-First Design that Performs",
  description:
    "Full-stack Shopify developer with a web-first graphic design background. I turn polished mockups into high-performing, accessible storefronts — plus WordPress/Astro sites for service businesses.",
};
---

<Base {...page}>
  <main class="wrap">
    <!-- Hero -->
    <section class="hero hero--cleanphoto" aria-labelledby="hero-title">
      <div>
        <div class="eyebrow">Shopify • Web-First Designer & Full-Stack Dev</div>
        <h1 id="hero-title" class="title">I build online stores and websites that look great and perform even better.</h1>
        <p class="lede">
          I’m a developer with a strong graphic design background. That means cleaner UI, tighter brand alignment, and
          pixel-accurate builds — I can take a visual mockup and program it almost identically in code.
          Shopify is my specialty for e-commerce. I also craft WordPress and Astro sites for service businesses.
        </p>
        <div class="cta-row" style="display:flex; gap:12px; flex-wrap:wrap;">
          <a class="cta" href="#projects">See Recent Web Work</a>
          <a class="cta secondary" href="#design">See Selected Design</a>
        </div>
      </div>

      <!-- Updated profile with color pop + 3-side trim -->
      <div class="hero-img hero-img--clean">
        <figure class="profile-wrap" aria-label="Profile photo">
          <!-- the gradient 'pop' and three-side trim are handled via ::before and ::after -->
          <img
            src="/images/profile.png"
            alt="Profile photo of Matt Blethen"
            width="1500"
            height="2000"
            loading="eager"
            decoding="async"
          />
        </figure>
      </div>
    </section>

    <!-- Who I Work With -->
    <section class="section" aria-labelledby="who-title">
      <h2 id="who-title">Who I Work With</h2>
      <p class="muted">
        I partner with store owners, founders, and local service providers who need more than a template.
        Whether you sell products online or offer services like real estate, construction, veterinary care, dental or medical,
        I build sites that help you attract visitors and turn them into customers. Need brand assets or campaign creatives?
        I handle those too — designed to work on the web first.
      </p>
    </section>

    <!-- Projects (Web-first) -->
    <section id="projects" class="section" aria-labelledby="projects-title">
      <h2 id="projects-title">Projects</h2>
      <p class="muted">Recent work across Shopify stores and custom websites.</p>

      <div class="grid" style="margin-top:14px">
        {webCards.map((c) => (
          <article class="card">
            <a href={c.url} class="thumb" aria-label={c.ariaLabel}>
              <img src={c.img} alt={c.title + " preview"} width="1200" height="675" loading="lazy" />
            </a>
            <div class="body">
              <p class="kicker">{c.kicker}</p>
              <h3>{c.title}</h3>
              {c.summary ? <p class="muted">{c.summary}</p> : null}
              <div class="tags">
                {c.tags.map((t: string) => <span class="tag">{t}</span>)}
              </div>
              <a class="view" href={c.url}>View project →</a>
            </div>
          </article>
        ))}
      </div>
    </section>

    {/* Selected Graphic Design (subtle, secondary) */}
    {designCards.length ? (
      <section id="design" class="section" aria-labelledby="design-title">
        <h2 id="design-title">Selected Graphic Design</h2>
        <p class="muted">
          Logos, brand systems, campaign art, and UI comps created with a web-first mindset. You can hire me for design-only,
          or as part of a full website or Shopify build.
        </p>

        <div class="grid design-grid" style="margin-top:10px">
          {designCards.map((c) => (
            <article class="card compact" style="--card-scale:0.94">
              <a href={c.url} class="thumb" aria-label={c.ariaLabel}>
                <img src={c.img} alt={c.title + " design preview"} width="1200" height="675" loading="lazy" />
              </a>
              <div class="body">
                <p class="kicker">Design</p>
                <h3>{c.title}</h3>
                {c.summary ? <p class="muted">{c.summary}</p> : null}
                <div class="tags">
                  {c.tags.map((t: string) => <span class="tag">{t}</span>)}
                </div>
                <a class="view" href={c.url}>View case →</a>
              </div>
            </article>
          ))}
        </div>
      </section>
    ) : null}

    <!-- Services -->
    <section id="services" class="section" aria-labelledby="services-title">
      <h2 id="services-title">Services</h2>
      <div class="services" role="list">
        <div class="service" role="listitem">
          <h4>Shopify Store Design & Development</h4>
          <p>Custom themes that showcase your products, simplify management, and boost conversions.</p>
        </div>
        <div class="service" role="listitem">
          <h4>Web-First Graphic Design & Brand Assets</h4>
          <p>
            Logos, brand kits, landing page/UI comps, and campaign creatives designed to translate cleanly to code.
            Hire me for design-only, or combine with development for seamless builds.
          </p>
        </div>
        <div class="service" role="listitem">
          <h4>Speed & Optimization</h4>
          <p>Faster load times, better search rankings, and a smoother experience on every device.</p>
        </div>
        <div class="service" role="listitem">
          <h4>Smart Integrations & Automation</h4>
          <p>Connect email, reviews, subscriptions, inventory, and more—so your store runs smoothly.</p>
        </div>
        <div class="service" role="listitem">
          <h4>WordPress & Custom Sites</h4>
          <p>Professional sites for service businesses like realtors, contractors, vets, dentists, and clinics.</p>
        </div>
        <div class="service" role="listitem">
          <h4>Ongoing Support</h4>
          <p>Updates, improvements, and performance tuning after launch—so you can focus on the business.</p>
        </div>
      </div>
    </section>

    <!-- Process -->
    <section class="section" aria-labelledby="process-title">
      <h2 id="process-title">How We’ll Work</h2>
      <div class="services" role="list">
        <div class="service" role="listitem">
          <h4>1) Discovery</h4>
          <p>We map your goals, products/services, and customers to define what success looks like.</p>
        </div>
        <div class="service" role="listitem">
          <h4>2) Build</h4>
          <p>Design and development tailored to your brand—focused on clarity, speed, and conversion.</p>
        </div>
        <div class="service" role="listitem">
          <h4>3) Launch & Support</h4>
          <p>Go live with confidence. I’m available for updates, enhancements, and ongoing optimization.</p>
        </div>
      </div>
    </section>

    <!-- Contact CTA -->
    <section class="cta-banner" aria-label="Contact banner">
      <p>
        <strong>Ready to grow your online business?</strong> Let’s build a site that’s fast, flexible, and built to convert.
        <br />
        Prefer design-only? I can deliver brand assets, UI comps, or campaign graphics that hand off cleanly to your team.
      </p>
      <div class="cta-row" style="display:flex; gap:12px; flex-wrap:wrap;">
        <a class="cta" href="/contact">Start a Web Project</a>
        <a class="cta secondary" href="/contact?type=design">Inquire: Design-Only</a>
      </div>
    </section>
  </main>

<style>
  /* Clean, minimal portrait presentation */
  .hero-img {
    display: grid;
    place-items: center;
  }

  .profile-wrap {
    position: relative;
    width: clamp(220px, 28vw, 380px);
    aspect-ratio: 3 / 4;
    border-radius: 50% / 55%; /* creates a natural oval shape */
    overflow: hidden;
    background: linear-gradient(180deg, #edf0f3 0%, #d7dee3 100%);
    box-shadow:
      0 6px 12px rgba(0,0,0,0.15);
  }

  .profile-wrap::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(100% 100% at 50% 20%, rgba(255,255,255,0.9), rgba(0,0,0,0.05));
    z-index: 1;
  }

  .profile-wrap img {
    position: relative;
    z-index: 2;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center top;
    display: block;
  }

  .profile-wrap::after {
    content: "";
    position: absolute;
    inset: 0;
    z-index: 3;
    border-left: 4px solid rgba(0,0,0,0.1);
    border-right: 4px solid rgba(0,0,0,0.1);
    border-bottom: 4px solid rgba(0,0,0,0.1);
    border-top: none;
    border-radius: inherit;
    pointer-events: none;
  }

  @media (max-width: 640px) {
    .profile-wrap {
      width: clamp(200px, 52vw, 320px);
    }
  }
  /* Remove the global “card” look just for this page’s hero image */
.hero--cleanphoto .hero-img,
.hero-img--clean{
  border: none;
  border-radius: 0;
  overflow: visible;
  box-shadow: none;
  background: transparent;
}

/* Don’t let the global rule make the image circular or add shadow */
.hero--cleanphoto .hero-img img{
  border-radius: 0;
  box-shadow: none;
}

/* Keep the clean oval presentation */
.profile-wrap{
  position: relative;
  width: clamp(220px, 28vw, 380px);
  aspect-ratio: 3 / 4;
  border-radius: 50% / 55%;
  overflow: hidden;
  background: linear-gradient(180deg, #edf0f3 0%, #d7dee3 100%);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}
.profile-wrap::before{
  content:"";
  position:absolute; inset:0; z-index:1;
  background: radial-gradient(100% 100% at 50% 20%, rgba(255,255,255,0.85), rgba(0,0,0,0.04));
}
.profile-wrap img{
  position: relative; z-index:2;
  width:100%; height:100%;
  object-fit: cover; object-position: center top;
  display:block;
}

/* Small screens */
@media (max-width: 640px){
  .profile-wrap{ width: clamp(200px, 52vw, 320px); }
}

</style>

</Base>
